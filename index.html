<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8>
	<title>Mesh 2D</title>
</head>
<body>
	<script type="text/javascript" src="lib/three.min.js"></script>
	<script type="text/javascript" src="lib/OrbitControls.js"></script>
	<script type="text/javascript" src="ImageGeometry.js"></script>
	<script type="text/javascript">
		var scene = new THREE.Scene();
		scene.background = new THREE.Color(0.4, 0.4, 0.4);

		var camera = new THREE.PerspectiveCamera(75, 1, 0.001, 1000);
		camera.position.z = 3;

		var canvas = document.createElement("canvas");
		canvas.style.position = "absolute";
		canvas.style.top = "0px";
		canvas.style.left = "0px";
		document.body.appendChild(canvas);

		var renderer = new THREE.WebGLRenderer({canvas:canvas, antialias:true});

		var wireframe = new THREE.MeshBasicMaterial({wireframe:true, transparent:true, opacity:0.5, color:0xFFFF00});

		var controls = new THREE.OrbitControls(camera, canvas);

		document.body.onresize = function()
		{
			var width = window.innerWidth;
			var height = window.innerHeight;
			renderer.setSize(width, height);
			camera.aspect = width / height;
			camera.updateProjectionMatrix();
		}
		document.body.onresize();

		function animate()
		{
			requestAnimationFrame(animate);
			controls.update();
			renderer.render(scene, camera);
		}
		animate();

		var source = "data/umbrella.png";
		
		var image = document.createElement("img");
		image.src = source;
		image.style.position = "absolute";
		image.style.zIndex = "100";
		image.style.height = "30%";
		document.body.appendChild(image);

		image.onload = function()
		{
			var geometry = new ImageGeometry();
			geometry.generate(image);

			var texture = new THREE.TextureLoader().load(source);
			var material = new THREE.MeshBasicMaterial({side:THREE.DoubleSide, map:texture, transparent:true});

			var object = new THREE.Mesh(geometry, material);
			scene.add(object);

			var helper = new THREE.Mesh(geometry, wireframe);
			scene.add(helper);

			var slider = document.createElement("input");
			slider.type = "range";
			slider.style.position = "absolute";
			slider.style.width = "150px";
			slider.style.height = "20px";
			slider.style.top = "33%";
			slider.max = 0.4;
			slider.min = 0.0;
			slider.step = 0.01;
			slider.value = geometry.detail;
			slider.onchange = function()
			{
				geometry.dispose();
				geometry = new ImageGeometry();
				geometry.detail = slider.value;
				geometry.generate(image);

				scene.remove(object);
				object = new THREE.Mesh(geometry, material);
				scene.add(object);

				scene.remove(helper);
				helper = new THREE.Mesh(geometry, wireframe);
				scene.add(helper);
			}
			document.body.appendChild(slider);
		};
	</script>
</body>
</html>
